# 브라우저 렌더링 과정

---

#### 1. 사용자가 브라우저 주소창에 https://example.com을 입력하고 엔터를 누르면, 어떤 과정으로 웹 페이지가 로딩되나요?

1. 사용자가 웹 브라우저를 통해 주소를 입력하면 URL 주소 중 도메인 부분을 DNS 서버에서 검색합니다.

- 이 때 브라우저는 로컬 DNS 캐시를 확인하여 최근에 조회한 도메인의 IP 주소가 있는지 확인합니다.
- 캐시에 없는 경우 DNS 서버에 조회 요청을 보냅니다.

2. DNS 서버에서 해당 도메인 주소에 해당하는 IP 주소를 찾아 사용자가 입력한 URL과 함께 전달합니다.

- 재귀적 탐색 : 로컬 DNS 서버가 필요한 모든 과정을 수행하여 직접 최종 응답 IP를 반환합니다.
- 반복적 탐색 : 클라이언트가 여러 DNS 서버를 순차적으로 탐색하여 최종 IP를 찾습니다.

3. 브라우저는 HTTP 프로토콜을 사용하여 요청 메세지를 생성하고 HTTP 요청 메세지는 TCP/IP 프로토콜을 사용해 서버로 전송됩니다.
4. 서버는 response 메세지를 생성하여 다시 브라우저에 데이터를 전송합니다.
5. 브라우저는 response를 받아 파싱하여 화면에 렌더링 합니다.

#### 2-1. 브라우저가 화면에 렌더링 되는 과정

> 브라우저가 화면에 나타나는 요소를 렌더링 할 때, 웹킷(Webkit)이나 게코(Gecko)같은 렌더링 엔진을 사용합니다.

1. HTML 파싱 후, DOM(Document Object Model) 트리 구축
2. CSS 파싱 후, CSSOM(CSS Object Model) 트리 구축
3. Javascript 실행
4. DOM과 CSSOM을 조합하여 렌더 트리 구축
5. 뷰포트 기반으로 렌더 트리의 각 노드가 가지는 정확한 위치와 크기 계산(Layout 단계)
6. 계산한 위치/크기를 기반으로 화면에 그리는 단계(Paint 단계)

#### 2-2. JavaScript는 왜 HTML 파싱을 블로킹(blocking)할 수 있을까요?

> HTML에서 자바스크립트 script를 만나면 script가 파싱됩니다. 이를 방지하기 위해서 백그라운드에서 동작할 수 있는 async, defer 태그를 사용합니다.

- async: HTML 파싱과 병렬로 JavaScript 다운로드 및 실행 (하지만 실행 순서 보장 X)
  - async로 로드된 스크립트는 다운로드가 끝나면 즉시 실행되어 다른 스크립트의 실행을 차단합니다.
- defer: HTML 파싱이 끝난 후 실행되며, 실행 순서가 보장됨
  - defer로 로드된 스크립트는 DOM이 상호작용 가능할때 실행되며 다른 동기적 스크립트의 실행을 차단하지 않습니다.

#### 2-3. Reflow와 Repaint의 차이점은 무엇이며, 성능 최적화를 위해 어떻게 줄일 수 있을까요?

> 렌더링이 반복되는 경우
>
> 1. 자바스크립트에 의한 노드의 추가/삭제
> 2. 브라우저 창의 리사이징에 의한 뷰포트 크기 변경
> 3. HTML 요소의 레이아웃에 변경을 발생시키는 스타일 변경

- Reflow : Layout 단계에서 수정이 발생하여 각 노드 위치를 렌더 트리에 다시 렌더링 할 때 발생합니다. 상위 엘리먼트가 변경될 시 하위 엘리먼트에 영향을 끼치기 때문에 비싼 작업입니다.

- Repaint : Layout 과정에서 영향을 미치지 않고 변경된 요소를 화면에 그려줄 때 발생합니다.

### Reflow와 Repaint 최소화 방법

- position fixed, absolute는 다른 엘리먼트에 레이아웃에 영향을 주지 않기 때문에 비용을 줄일 수 있습니다.
- display : none 사용 시 Reflow, Repaint가 발생하지 않습니다.
- transform, opacity 속성 사용 시 Reflow, Repaint가 발생하지 않습니다.
- requestAnimationFrame() 메소드를 이용해 브라우저의 프레임 속도(60fps)에 맞추어 지연 및 블로킹 없이 콜백을 실행할 수 있습니다.

### Javascript에서 Reflow 최소화 방법

- 스타일 적용 시 개별적으로 적용하지 않고 CSS class 변경으로 Reflow를 한번만 발생 시키도록 처리
- style.cssText를 사용하여 한번에 스타일 적용
- DOM을 직접 수정하는 대신 documentFragment를 사용해 한번의 Reflow만 발생시키도록 처리
